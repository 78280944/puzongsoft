<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lottery.orm.dao.LotteryGameRoundMapper" >
  <resultMap id="BaseResultMap" type="com.lottery.orm.bo.LotteryGameRound" >
    <result column="LGRID" property="lgrid" jdbcType="INTEGER" />
    <result column="SID" property="sid" jdbcType="INTEGER" />
    <result column="LOTTERYTERM" property="lotteryterm" jdbcType="VARCHAR" />
    <result column="LOTTERYRESULT" property="lotteryresult" jdbcType="VARCHAR" />
    <result column="STARTTIME" property="starttime" jdbcType="TIMESTAMP" />
    <result column="OVERTIME" property="overtime" jdbcType="TIMESTAMP" />
    <result column="OPENTIME" property="opentime" jdbcType="TIMESTAMP" />
    <result column="CLOSETIME" property="closetime" jdbcType="TIMESTAMP" />
    <result column="ACTOPENTIME" property="actopentime" jdbcType="TIMESTAMP" />
    <result column="ACTCLOSETIME" property="actclosetime" jdbcType="TIMESTAMP" />
  </resultMap>
  
  <resultMap id="ResultGameMap" type="com.lottery.orm.dto.ResultDataDto" >
    <result column="LGRID" property="lgrid" jdbcType="INTEGER" />
    <result column="LOTTERYTERM" property="lotteryterm" jdbcType="VARCHAR" />
    <result column="LOTTERYRESULT" property="lotteryresult" jdbcType="VARCHAR" />
  </resultMap>
  
  <insert id="insert" parameterType="com.lottery.orm.bo.LotteryGameRound" >
    <selectKey resultType="java.lang.Integer" keyProperty="lgrid" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into lottery_game_round (SID, LOTTERYTERM, LOTTERYRESULT, 
      STARTTIME, OVERTIME, OPENTIME, 
      CLOSETIME, ACTOPENTIME, ACTCLOSETIME
      )
    values (#{sid,jdbcType=INTEGER}, #{lotteryterm,jdbcType=VARCHAR}, #{lotteryresult,jdbcType=VARCHAR}, 
      #{starttime,jdbcType=TIMESTAMP}, #{overtime,jdbcType=TIMESTAMP}, #{opentime,jdbcType=TIMESTAMP}, 
      #{closetime,jdbcType=TIMESTAMP}, #{actopentime,jdbcType=TIMESTAMP}, #{actclosetime,jdbcType=TIMESTAMP}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.lottery.orm.bo.LotteryGameRound" >
    <selectKey resultType="java.lang.Integer" keyProperty="lgrid" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into lottery_game_round
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="sid != null" >
        SID,
      </if>
      <if test="lotteryterm != null" >
        LOTTERYTERM,
      </if>
      <if test="lotteryresult != null" >
        LOTTERYRESULT,
      </if>
      <if test="starttime != null" >
        STARTTIME,
      </if>
      <if test="overtime != null" >
        OVERTIME,
      </if>
      <if test="opentime != null" >
        OPENTIME,
      </if>
      <if test="closetime != null" >
        CLOSETIME,
      </if>
      <if test="actopentime != null" >
        ACTOPENTIME,
      </if>
      <if test="actclosetime != null" >
        ACTCLOSETIME,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="sid != null" >
        #{sid,jdbcType=INTEGER},
      </if>
      <if test="lotteryterm != null" >
        #{lotteryterm,jdbcType=VARCHAR},
      </if>
      <if test="lotteryresult != null" >
        #{lotteryresult,jdbcType=VARCHAR},
      </if>
      <if test="starttime != null" >
        #{starttime,jdbcType=TIMESTAMP},
      </if>
      <if test="overtime != null" >
        #{overtime,jdbcType=TIMESTAMP},
      </if>
      <if test="opentime != null" >
        #{opentime,jdbcType=TIMESTAMP},
      </if>
      <if test="closetime != null" >
        #{closetime,jdbcType=TIMESTAMP},
      </if>
      <if test="actopentime != null" >
        #{actopentime,jdbcType=TIMESTAMP},
      </if>
      <if test="actclosetime != null" >
        #{actclosetime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  
  <select id="selectGameResultBytime" resultMap="ResultGameMap">
    select 
    a.lgrid,a.lotteryterm,a.lotteryresult
    from lottery_game_round a
    where a.sid = #{sid,jdbcType=INTEGER}
    and
    a.lotteryterm  = getLotteryTerm(#{time,jdbcType=VARCHAR})
   <if test="beginRow != null and pageSize !=null">
	limit #{beginRow,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
	</if>
  </select>
  
    <select id="selectGameResult" resultMap="ResultGameMap">
    select 
    a.lgrid,a.lotteryterm,a.lotteryresult
    from lottery_game_round a
    where a.sid = #{sid,jdbcType=INTEGER}
    and
    (Date(a.opentime) BETWEEN #{startTime,jdbcType=TIMESTAMP} and #{endTime,jdbcType=TIMESTAMP})
    <if test="beginRow != null and pageSize !=null">
	limit #{beginRow,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
	</if>
  </select>

  <select id="selectCurGameResult" resultMap="BaseResultMap">
    select 
    a.lgrid,a.sid,a.lotteryterm,a.lotteryresult,a.starttime,a.overtime,a.opentime,a.closetime,a.actopentime,a.actclosetime 
    from lottery_game_round a
    where a.sid = #{sid,jdbcType=INTEGER} and a.lotteryterm = #{lotteryterm,jdbcType=VARCHAR}
  </select>
  
</mapper>